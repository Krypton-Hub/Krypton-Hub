local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "BrainrotTestGUI"
gui.Parent = game.CoreGui

local function createButton(name, posY)
    local button = Instance.new("TextButton")
    button.Parent = gui
    button.Size = UDim2.new(0, 160, 0, 30)
    button.Position = UDim2.new(0, 10, 0, posY)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 14
    button.BorderSizePixel = 0
    button.Text = name
    return button
end

-- Variables
local autoSteal = false
local flying = false
local flySpeed = 60
local bodyGyro, bodyVelocity

-- Buttons
local stealBtn = createButton("Ativar Auto Steal", 50)
local flyBtn = createButton("Ativar Fly", 90)

-- Auto Steal Function
local function stealBrainrot()
    task.spawn(function()
        while autoSteal do
            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    local brainrot = plr:FindFirstChild("Brainrot") or (plr.Character and plr.Character:FindFirstChild("Brainrot"))
                    if brainrot and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        LocalPlayer.Character.HumanoidRootPart.CFrame = plr.Character.HumanoidRootPart.CFrame + Vector3.new(0, 2, 0)
                        task.wait(0.4)
                        pcall(function()
                            firetouchinterest(LocalPlayer.Character.HumanoidRootPart, brainrot, 0)
                            firetouchinterest(LocalPlayer.Character.HumanoidRootPart, brainrot, 1)
                        end)
                    end
                end
            end
            task.wait(1)
        end
    end)
end

-- Fly Functions
local function startFly()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end

    bodyGyro = Instance.new("BodyGyro")
    bodyGyro.Parent = char.HumanoidRootPart
    bodyGyro.P = 9e4
    bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bodyGyro.CFrame = char.HumanoidRootPart.CFrame

    bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Parent = char.HumanoidRootPart
    bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)

    flying = true

    task.spawn(function()
        while flying and char and char:FindFirstChild("HumanoidRootPart") do
            local moveDirection = Vector3.new(0, 0, 0)
            if UIS:IsKeyDown(Enum.KeyCode.W) then
                moveDirection = moveDirection + Workspace.CurrentCamera.CFrame.LookVector
            end
            if UIS:IsKeyDown(Enum.KeyCode.S) then
                moveDirection = moveDirection - Workspace.CurrentCamera.CFrame.LookVector
            end
            if UIS:IsKeyDown(Enum.KeyCode.A) then
                moveDirection = moveDirection - Workspace.CurrentCamera.CFrame.RightVector
            end
            if UIS:IsKeyDown(Enum.KeyCode.D) then
                moveDirection = moveDirection + Workspace.CurrentCamera.CFrame.RightVector
            end
            if UIS:IsKeyDown(Enum.KeyCode.Space) then
                moveDirection = moveDirection + Vector3.new(0, 1, 0)
            end
            if UIS:IsKeyDown(Enum.KeyCode.LeftControl) then
                moveDirection = moveDirection - Vector3.new(0, 1, 0)
            end

            bodyVelocity.Velocity = moveDirection * flySpeed
            bodyGyro.CFrame = Workspace.CurrentCamera.CFrame
            RunService.RenderStepped:Wait()
        end
    end)
end

local function stopFly()
    if bodyGyro then bodyGyro:Destroy() end
    if bodyVelocity then bodyVelocity:Destroy() end
    flying = false
end

-- Button Event Handlers
stealBtn.MouseButton1Click:Connect(function()
    autoSteal = not autoSteal
    stealBtn.Text = autoSteal and "Desativar Auto Steal" or "Ativar Auto Steal"
    if autoSteal then
        stealBrainrot()
    end
end)

flyBtn.MouseButton1Click:Connect(function()
    flying = not flying
    flyBtn.Text = flying and "Desativar Fly" or "Ativar Fly"
    if flying then
        startFly()
    else
        stopFly()
    end
end)

-- Cleanup on Player Death or Script End
LocalPlayer.CharacterAdded:Connect(function()
    if flying then
        stopFly()
        flying = true
        startFly()
    end
end)
